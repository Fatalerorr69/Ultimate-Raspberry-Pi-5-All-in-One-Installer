Ultimate Raspberry Pi 5 All-in-One Installer
KompletnÃ­ automatickÃ½ instalaÄnÃ­ systÃ©m s interaktivnÃ­m konfigurÃ¡torem

ðŸ“¦ OKAMÅ½ITÃ‰ SPUÅ TÄšNÃ (JednÃ­m pÅ™Ã­kazem)
bash
# StÃ¡hnÄ›te a spusÅ¥te instalaÄnÃ­ skript
wget -O - https://raw.githubusercontent.com/raspberrypi/scripts/main/installers/automated-setup.sh | bash

# Nebo pokud mÃ¡te vlastnÃ­ skript:
curl -L https://vase-domena.cz/pi5-installer.sh | bash
ðŸš€ RYCHLÃ INSTALAÄŒNÃ MANUÃL (3 kroky)
Krok 1: PÅ™Ã­prava zÃ¡kladnÃ­ho systÃ©mu
bash
# SpusÅ¥te zÃ¡kladnÃ­ instalaci
./installer.sh --quick-setup
Krok 2: InteraktivnÃ­ vÃ½bÄ›r sluÅ¾eb
bash
# SpusÅ¥te konfigurÃ¡tor
./installer.sh --config-wizard
Krok 3: AutomatickÃ© nasazenÃ­
bash
# SpusÅ¥te instalaci vÅ¡ech sluÅ¾eb
./installer.sh --deploy-all
ðŸ”§ KOMPLETNÃ INSTALAÄŒNÃ SOUBOR installer.sh
bash
#!/bin/bash
set -e

# ðŸ“ KONFIGURAÄŒNÃ PROMÄšNNÃ‰
PI_USER="pi"
PI_HOSTNAME="raspberrypi5"
TIMEZONE="Europe/Prague"
DOCKER_NETWORK="pi5-network"

# ðŸŽ¨ BARVY PRO VÃPIS
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m'

# ðŸ“Š FUNKCE PRO LOGOVÃNÃ
log() {
    echo -e "${GREEN}[$(date +'%Y-%m-%d %H:%M:%S')]${NC} $1"
}

warn() {
    echo -e "${YELLOW}[VAROVÃNÃ]${NC} $1"
}

error() {
    echo -e "${RED}[CHYBA]${NC} $1"
    exit 1
}

# ðŸ” KONTROLA PRÃV A ZÃVISLOSTÃ
check_dependencies() {
    log "Kontrola zÃ¡vislostÃ­ a oprÃ¡vnÄ›nÃ­..."
    
    if [[ $EUID -eq 0 ]]; then
        error "Skript nesmÃ­ bÃ½t spuÅ¡tÄ›n jako root. PouÅ¾ijte bÄ›Å¾nÃ©ho uÅ¾ivatele."
    fi
    
    if ! command -v curl &> /dev/null; then
        sudo apt update && sudo apt install -y curl wget
    fi
}

# ðŸ³ INSTALACE DOCKERU
install_docker() {
    log "Instalace Docker Engine..."
    
    # OdstranÄ›nÃ­ starÃ½ch verzÃ­
    sudo apt remove -y docker docker-engine docker.io containerd runc 2>/dev/null || true
    
    # Instalace zÃ¡vislostÃ­
    sudo apt update
    sudo apt install -y \
        ca-certificates \
        curl \
        gnupg \
        lsb-release
    
    # PÅ™idÃ¡nÃ­ oficiÃ¡lnÃ­ho GPG klÃ­Äe
    sudo mkdir -p /etc/apt/keyrings
    curl -fsSL https://download.docker.com/linux/debian/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg
    
    # NastavenÃ­ repozitÃ¡Å™e
    echo "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/debian $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null
    
    # Instalace Dockeru
    sudo apt update
    sudo apt install -y docker-ce docker-ce-cli containerd.io docker-compose-plugin
    
    # PÅ™idÃ¡nÃ­ uÅ¾ivatele do skupiny docker
    sudo usermod -aG docker $USER
    log "Docker ÃºspÄ›Å¡nÄ› nainstalovÃ¡n. Pro aplikovÃ¡nÃ­ zmÄ›n se odhlaste a pÅ™ihlaste."
}

# ðŸ“ PÅ˜ÃPRAVA ADRESÃÅ˜Å®
setup_directories() {
    log "PÅ™Ã­prava adresÃ¡Å™ovÃ© struktury..."
    
    mkdir -p ~/docker-stack/{config,data,backups}
    mkdir -p ~/docker-stack/config/{portainer,heimdall,nextcloud,vaultwarden,jellyfin,homeassistant,pihole,monitoring}
    mkdir -p ~/docker-stack/data/{media,downloads,documents,backups}
    
    log "AdresÃ¡Å™ovÃ¡ struktura vytvoÅ™ena"
}

# ðŸ› ï¸ VYTVOÅ˜ENÃ DOCKER-COMPOSE.SH
create_docker_compose() {
    cat > ~/docker-stack/docker-compose.yml << 'EOF'
version: '3.8'

services:
  # ðŸŽ¯ SPRÃVA SYSTÃ‰MU
  portainer:
    image: portainer/portainer-ce:latest
    container_name: portainer
    restart: unless-stopped
    ports: ["9000:9000"]
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - ./config/portainer:/data
    networks: [pi5-network]

  # ðŸ“Š MONITORING
  glances:
    image: nicolargo/glances:latest
    container_name: glances
    restart: unless-stopped
    ports: ["61208:61208"]
    volumes: [/var/run/docker.sock:/var/run/docker.sock:ro]
    networks: [pi5-network]

  # ðŸ  DASHBOARD
  heimdall:
    image: lscr.io/linuxserver/heimdall:latest
    container_name: heimdall
    restart: unless-stopped
    ports: ["8080:80"]
    environment: {TZ: Europe/Prague, PUID: 1000, PGID: 1000}
    volumes: [./config/heimdall:/config]
    networks: [pi5-network]

  # â˜ï¸ CLOUDOVÃ‰ ÃšLOÅ½IÅ TÄš
  nextcloud:
    image: nextcloud:latest
    container_name: nextcloud
    restart: unless-stopped
    ports: ["8081:80"]
    environment: {TZ: Europe/Prague}
    volumes: [./config/nextcloud:/var/www/html, ./data/documents:/var/www/html/data/documents]
    networks: [pi5-network]

  # ðŸ” SPRÃVCE HESEL
  vaultwarden:
    image: vaultwarden/server:latest
    container_name: vaultwarden
    restart: unless-stopped
    ports: ["8082:80"]
    environment: {WEBSOCKET_ENABLED: "true", SIGNUPS_ALLOWED: "false"}
    volumes: [./config/vaultwarden:/data]
    networks: [pi5-network]

  # ðŸŽ¬ MEDIÃLNÃ SERVER
  jellyfin:
    image: jellyfin/jellyfin:latest
    container_name: jellyfin
    restart: unless-stopped
    ports: ["8096:8096"]
    environment: {TZ: Europe/Prague}
    volumes: [./config/jellyfin:/config, ./data/media:/media]
    networks: [pi5-network]

  # ðŸ¡ CHYTRÃ DOMÃCNOST
  homeassistant:
    image: ghcr.io/home-assistant/home-assistant:stable
    container_name: homeassistant
    restart: unless-stopped
    ports: ["8123:8123"]
    environment: {TZ: Europe/Prague}
    volumes: [./config/homeassistant:/config, /etc/localtime:/etc/localtime:ro]
    networks: [pi5-network]

  # ðŸ›¡ï¸ BLOKOVÃNÃ REKLAM
  pihole:
    image: pihole/pihole:latest
    container_name: pihole
    restart: unless-stopped
    ports: ["53:53/tcp", "53:53/udp", "80:80"]
    environment: {TZ: Europe/Prague, WEBPASSWORD: change_this_password}
    volumes: [./config/pihole/etc-pihole:/etc/pihole, ./config/pihole/etc-dnsmasq.d:/etc/dnsmasq.d]
    networks: [pi5-network]

networks:
  pi5-network:
    driver: bridge
EOF

    log "HlavnÃ­ docker-compose.yml vytvoÅ™en"
}

# âš™ï¸ INTERAKTIVNÃ KONFIGURÃTOR
interactive_configurator() {
    log "SpouÅ¡tÃ­m interaktivnÃ­ konfigurÃ¡tor..."
    
    # VÃ½bÄ›r sluÅ¾eb
    echo "Vyberte sluÅ¾by k instalaci:"
    services=("Portainer" "Heimdall" "Nextcloud" "Vaultwarden" "Jellyfin" "Home Assistant" "Pi-hole")
    selected_services=()
    
    for service in "${services[@]}"; do
        read -p "Nainstalovat $service? (y/n) " -n 1 -r
        echo
        if [[ $REPLY =~ ^[Yy]$ ]]; then
            selected_services+=("$service")
        fi
    done
    
    # Konfigurace hesel
    read -s -p "Zadejte heslo pro Pi-hole admin rozhranÃ­: " pihole_password
    echo
    read -s -p "Zadejte heslo pro Vaultwarden: " vaultwarden_password
    echo
    
    # Aktualizace docker-compose s hesly
    sed -i "s/change_this_password/$pihole_password/" ~/docker-stack/docker-compose.yml
    
    log "Konfigurace dokonÄena. VybrÃ¡no sluÅ¾eb: ${#selected_services[@]}"
}

# ðŸš€ SPUÅ TÄšNÃ SLUÅ½EB
deploy_services() {
    log "SpouÅ¡tÃ­m vÅ¡echny sluÅ¾by..."
    cd ~/docker-stack
    
    # VytvoÅ™enÃ­ Docker network
    docker network create $DOCKER_NETWORK 2>/dev/null || true
    
    # SpuÅ¡tÄ›nÃ­ sluÅ¾eb
    docker-compose up -d
    
    # ÄŒekÃ¡nÃ­ na start sluÅ¾eb
    sleep 10
    
    # Kontrola stavu
    log "Kontrola stavu kontejnerÅ¯..."
    docker-compose ps
}

# ðŸ“Š GENEROVÃNÃ PÅ˜ÃSTUPOVÃCH ÃšDAJÅ®
generate_access_info() {
    local ip_address=$(hostname -I | awk '{print $1}')
    
    cat > ~/docker-stack/ACCESS_INFO.txt << EOF
=== RASPBERRY PI 5 ALL-IN-ONE SYSTEM ===
Datum instalace: $(date)
IP adresa: $ip_address

ðŸ“‹ PÅ˜ÃSTUPOVÃ‰ ÃšDAJE:

ðŸ› ï¸  Portainer (SprÃ¡va kontejnerÅ¯):
   URL: http://$ip_address:9000
   PoznÃ¡mka: PrvnÃ­ pÅ™ihlÃ¡Å¡enÃ­ vytvoÅ™Ã­ admin ÃºÄet

ðŸ“Š Heimdall (Dashboard):
   URL: http://$ip_address:8080

â˜ï¸  Nextcloud (CloudovÃ© ÃºloÅ¾iÅ¡tÄ›):
   URL: http://$ip_address:8081
   PoznÃ¡mka: PrvnÃ­ pÅ™ihlÃ¡Å¡enÃ­ vytvoÅ™Ã­ admin ÃºÄet

ðŸ” Vaultwarden (SprÃ¡vce hesel):
   URL: http://$ip_address:8082
   PoznÃ¡mka: Registrace novÃ½ch ÃºÄtÅ¯ je vypnutÃ¡

ðŸŽ¬ Jellyfin (MediÃ¡lnÃ­ server):
   URL: http://$ip_address:8096

ðŸ  Home Assistant (ChytrÃ¡ domÃ¡cnost):
   URL: http://$ip_address:8123

ðŸ›¡ï¸  Pi-hole (BlokovÃ¡nÃ­ reklam):
   URL: http://$ip_address:80
   Admin heslo: $(grep WEBPASSWORD ~/docker-stack/docker-compose.yml | cut -d: -f2 | tr -d ' "')

ðŸ“ˆ Glances (Monitoring):
   URL: http://$ip_address:61208

ðŸ”§ SPRÃVA SYSTÃ‰MU:

ZastavenÃ­ vÅ¡ech sluÅ¾eb:
  cd ~/docker-stack && docker-compose down

Restart sluÅ¾eb:
  cd ~/docker-stack && docker-compose restart

Aktualizace vÅ¡ech sluÅ¾eb:
  cd ~/docker-stack && docker-compose pull && docker-compose up -d

ZÃ¡loha dat:
  cp -r ~/docker-stack/config ~/docker-stack/backups/config_\$(date +%Y%m%d)

EOF

    log "PÅ™Ã­stupovÃ© Ãºdaje uloÅ¾eny do: ~/docker-stack/ACCESS_INFO.txt"
}

# ðŸ”„ SKRIPT PRO AKTUALIZACI
create_update_script() {
    cat > ~/docker-stack/update-services.sh << 'EOF'
#!/bin/bash
echo "Aktualizace vÅ¡ech sluÅ¾eb..."
cd ~/docker-stack
docker-compose pull
docker-compose up -d
docker system prune -f
echo "Aktualizace dokonÄena!"
EOF
    
    chmod +x ~/docker-stack/update-services.sh
}

# ðŸŽ¯ HLAVNÃ FUNKCE
main() {
    clear
    echo "================================================"
    echo "  ULTIMATE RASPBERY PI 5 ALL-IN-ONE INSTALLER  "
    echo "================================================"
    echo ""
    
    case "${1:-}" in
        "--quick-setup")
            check_dependencies
            install_docker
            setup_directories
            create_docker_compose
            ;;
        "--config-wizard")
            interactive_configurator
            ;;
        "--deploy-all")
            deploy_services
            generate_access_info
            create_update_script
            ;;
        "--full-install")
            check_dependencies
            install_docker
            setup_directories
            create_docker_compose
            interactive_configurator
            deploy_services
            generate_access_info
            create_update_script
            ;;
        *)
            echo "PouÅ¾itÃ­: $0 [option]"
            echo "Options:"
            echo "  --quick-setup    ZÃ¡kladnÃ­ instalace Dockeru a struktury"
            echo "  --config-wizard  InteraktivnÃ­ konfigurace sluÅ¾eb"
            echo "  --deploy-all     SpuÅ¡tÄ›nÃ­ vÅ¡ech sluÅ¾eb"
            echo "  --full-install   KompletnÃ­ instalace (doporuÄeno)"
            echo ""
            echo "PÅ™Ã­klad kompletnÃ­ instalace:"
            echo "  $0 --full-install"
            exit 1
            ;;
    esac
    
    log "Instalace dokonÄena ÃºspÄ›Å¡nÄ›!"
    echo ""
    echo "ðŸ“‹ DalÅ¡Ã­ kroky:"
    echo "1. Pro aplikovÃ¡nÃ­ Docker skupiny se odhlaste a pÅ™ihlaste"
    echo "2. PÅ™Ã­stupovÃ© Ãºdaje najdete v ~/docker-stack/ACCESS_INFO.txt"
    echo "3. SluÅ¾by jsou dostupnÃ© na IP adrese: $(hostname -I | awk '{print $1}')"
}

# ðŸ SPUÅ TÄšNÃ HLAVNÃ FUNKCE
main "$@"
ðŸŽ¯ JEDNODUCHÃ‰ POUÅ½ITÃ
RychlÃ¡ instalace (1 pÅ™Ã­kaz):
bash
# StaÅ¾enÃ­ a spuÅ¡tÄ›nÃ­ kompletnÃ­ instalace
wget https://example.com/pi5-installer.sh && chmod +x pi5-installer.sh
./pi5-installer.sh --full-install
PostupovÃ¡ instalace (3 pÅ™Ã­kazy):
bash
# 1. PÅ™Ã­prava systÃ©mu
./pi5-installer.sh --quick-setup

# 2. Konfigurace (interaktivnÃ­)
./pi5-installer.sh --config-wizard

# 3. NasazenÃ­ sluÅ¾eb
./pi5-installer.sh --deploy-all
ðŸ“± PÅ˜ÃSTUP KE SLUÅ½BÃM
Po instalaci budou sluÅ¾by dostupnÃ© na vaÅ¡Ã­ IP adrese:

SluÅ¾ba	Port	Popis
Portainer	9000	SprÃ¡va kontejnerÅ¯
Heimdall	8080	HlavnÃ­ dashboard
Nextcloud	8081	CloudovÃ© ÃºloÅ¾iÅ¡tÄ›
Vaultwarden	8082	SprÃ¡vce hesel
Jellyfin	8096	MediÃ¡lnÃ­ server
Home Assistant	8123	ChytrÃ¡ domÃ¡cnost
Pi-hole	80	BlokovÃ¡nÃ­ reklam
ðŸ”„ SPRÃVA SYSTÃ‰MU
Aktualizace vÅ¡ech sluÅ¾eb:
bash
~/docker-stack/update-services.sh
ZÃ¡loha konfigurace:
bash
cp -r ~/docker-stack/config ~/backups/config_$(date +%Y%m%d)
ObnovenÃ­ ze zÃ¡lohy:
bash
cp -r ~/backups/config_20241219/* ~/docker-stack/config/
docker-compose restart
âš ï¸ DÅ®LEÅ½ITÃ‰ POZNÃMKY
Po instalaci Dockeru se odhlaste a pÅ™ihlaste pro aplikovÃ¡nÃ­ prÃ¡v

PrvnÃ­ spuÅ¡tÄ›nÃ­ sluÅ¾eb mÅ¯Å¾e trvat nÄ›kolik minut (stahovÃ¡nÃ­ image)

Pro Pi-hole nastavte v routeru DNS na IP Raspberry Pi

PravidelnÄ› aktualizujte pomocÃ­ update-services.sh

Tento instalÃ¡tor vytvÃ¡Å™Ã­ kompletnÃ­ produktivnÃ­ systÃ©m na Raspberry Pi 5 s minimem uÅ¾ivatelskÃ©ho ÃºsilÃ­! ðŸŽ‰